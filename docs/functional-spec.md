# 기능 명세서 (Functional Specification)

## 1. 개요

**프로젝트명**: 사워도우 베이킹 도우미 (Sourdough Timer)
**버전**: 0.0.5
**최종 수정일**: 2025-12-29

### 1.1 목적
사워도우 및 일반 도우 제빵을 위한 재료 계산 및 다단계 타이머 기능을 제공하는 모바일 애플리케이션

### 1.2 대상 사용자
- 가정에서 사워도우 빵을 만드는 베이커
- 일반 도우로 빵/피자를 만드는 사용자
- 베이커스 퍼센티지 계산이 필요한 제빵 입문자

---

## 2. 주요 기능

### 2.1 사용자 인증
#### 2.1.1 로그인
- **기능**: 이메일과 비밀번호로 로그인
- **화면**: LoginScreen
- **데이터**: Users 테이블
- **상태**: TODO (현재 더미 구현)

#### 2.1.2 회원가입
- **기능**: 새 계정 생성
- **화면**: LoginScreen
- **데이터**: Users 테이블에 저장
- **상태**: 구현 완료

---

### 2.2 베이커스 퍼센티지 계산기 (사워도우)

#### 2.2.1 기본 정보 입력
- **총 르방 양 (g)**: 제작할 총 르방(스타터) 무게
- **온도 (°C)**: 발효 온도
- **준비 시간**: 발효에 소요될 시간 (4-24시간)

#### 2.2.2 자동 비율 설정
준비 시간에 따라 자동으로 비율(스타터:밀가루:물) 적용:
- 4-6시간: 1:1:1
- 6-8시간: 1:2:2
- 8-10시간: 1:3:3
- 10-12시간: 1:4:4
- 12-14시간: 1:5:5
- 16-24시간: 1:10:10

#### 2.2.3 수동 비율 조정
- 스타터, 밀가루, 물 비율을 개별적으로 조정 가능
- 실시간 계산 결과 표시

#### 2.2.4 계산 결과
- 스타터 (g)
- 밀가루 (g)
- 물 (g)

#### 2.2.5 레시피 저장
- **저장 항목**:
  - 레시피 이름
  - 계산 타입: 'unified'
  - 입력값 및 계산 결과
- **데이터**: Recipes 테이블

---

### 2.3 도우 계산기

#### 2.3.1 기본 정보 입력
- **총 도우 무게 (g)**: 만들 도우의 총 무게

#### 2.3.2 베이커스 퍼센티지 입력
- **물 (%)**: 기본값 70%
- **소금 (%)**: 기본값 2%
- **르방 (%)**: 기본값 20%

#### 2.3.3 양방향 입력 시스템
**% 입력 방식**:
- % 값 입력 → 자동으로 g 계산

**g 입력 방식**:
- g 값 입력 → 자동으로 % 역계산
- 전체 비율 재계산
- 다른 모든 재료의 g 값 자동 재조정

**동작 원리**:
1. 사용자가 물 200g 입력
2. 밀가루 대비 % 자동 계산
3. 전체 베이커스 퍼센티지 재계산
4. 소금, 르방 등 다른 재료 g 값 자동 재조정
5. 총 도우 무게는 고정 유지

#### 2.3.4 밀가루 상세 입력
- **기능**: 여러 종류의 밀가루 혼합 사용
- **입력 항목**:
  - 밀가루 이름 (예: 강력분, 통밀, 호밀)
  - 각 밀가루 양 (g)
- **검증**:
  - 합계가 총 밀가루 양과 일치해야 함
  - 불일치 시 경고 표시 (초과/부족 g 표시)
- **백분율 표시**: 각 밀가루가 전체 밀가루에서 차지하는 비율

#### 2.3.5 추가 재료 입력
- **기능**: 올리브유, 버터, 설탕 등 추가 재료
- **입력 방식**: % 또는 g (양방향)
- **자동 반영**: 추가 재료가 전체 도우 계산에 반영
  - 전체 베이커스 퍼센티지에 포함
  - 모든 재료 양 자동 재조정

#### 2.3.6 계산 결과
- 밀가루 (g) + 상세 내역
- 물 (g)
- 소금 (g)
- 르방 (g)
- 추가 재료들 (g)

#### 2.3.7 레시피 저장
- **저장 항목**:
  - 레시피 이름
  - 계산 타입: 'dough'
  - 모든 재료 정보 (JSON)
  - 밀가루 상세 정보 (JSON)
  - 추가 재료 정보 (JSON)

---

### 2.4 내 레시피 관리

#### 2.4.1 레시피 목록
- **표시 정보**:
  - 레시피 이름
  - 생성 일시
  - 레시피 타입 (사워도우/도우)
- **정렬**: 최신순
- **데이터**: Recipes 테이블 실시간 감시 (Stream)

#### 2.4.2 레시피 상세 보기
- **입력 정보**:
  - 총 도우 무게 또는 총 르방
  - 베이커스 퍼센티지
  - 온도 (사워도우만)
- **계산 결과**:
  - 모든 재료별 무게
  - 밀가루 상세 내역 (있는 경우)
  - 추가 재료 내역 (있는 경우)

#### 2.4.3 레시피 삭제
- **기능**: 레시피 삭제
- **데이터**: Recipes 테이블에서 삭제

#### 2.4.4 타이머 시작
- **버튼**: "이 레시피로 타이머 시작"
- **동작**: TimerSetupScreen으로 이동
- **전달**: Recipe 객체

---

### 2.5 타이머 시스템

#### 2.5.1 타이머 설정 화면
**초기 로드**:
- 레시피에 저장된 타이머 단계가 있으면 로드
- 없으면 레시피 타입별 기본 템플릿 사용

**사워도우 템플릿** (calculationType = 'unified'):
1. 오토리즈 (Autolyse) - 1시간
2. 1차 발효 시작 - 30분
3. 폴딩 #1 - 30분
4. 폴딩 #2 - 30분
5. 폴딩 #3 - 3시간
6. 성형 및 벤치 레스트 - 30분
7. 2차 발효 (냉장) - 12시간
8. 굽기 - 45분

**일반 도우 템플릿** (calculationType = 'dough'):
1. 오토리즈 (Autolyse) - 30분
2. 1차 발효 - 1시간
3. 폴딩 - 30분
4. 분할 및 둥글리기 - 15분
5. 벤치 타임 - 20분
6. 성형 - 15분
7. 2차 발효 - 45분
8. 굽기 - 25분

#### 2.5.2 단계 편집
**추가**:
- "단계 추가" 버튼
- 기본값: "새 단계", 30분

**수정**:
- 단계 이름 수정
- 시간 입력 (시간 + 분)
  - 시간 필드: 0-99시간
  - 분 필드: 0-59분
  - 내부 저장: 총 분으로 변환

**삭제**:
- 각 단계 옆 삭제 버튼

#### 2.5.3 타이머 시작
1. "타이머 시작" 버튼 클릭
2. 현재 타이머 단계를 레시피에 저장 (timerSteps JSON)
3. Background Service에 타이머 데이터 전송
4. 메인 화면으로 돌아가기
5. **자동으로 타이머 탭으로 전환**

#### 2.5.4 타이머 진행 화면
**표시 정보**:
- 레시피 이름
- 현재 단계 이름
- 현재 단계 번호 / 전체 단계 수
- 남은 시간 (HH:MM:SS)
- 전체 진행률 (Progress Bar)

**완료 상태**:
- "모든 단계 완료!" 메시지

**삭제**:
- 삭제 버튼으로 타이머 중단 및 제거

#### 2.5.5 백그라운드 서비스
- **기능**: 앱이 백그라운드에 있어도 타이머 동작
- **알림**: 각 단계 완료 시 푸시 알림
- **데이터 동기화**: 실시간으로 UI 업데이트

---

### 2.6 가이드

#### 2.6.1 앱 사용법
- 베이커스 계산기 사용법
- 도우 계산기 사용법
- 타이머 사용법

#### 2.6.2 베이커스 퍼센티지 설명
- 기본 개념
- 계산 예시
- 추가 재료 포함 계산
- 양방향 입력 예시

#### 2.6.3 용어 설명
- 르방 (Levain)
- 도우 (Dough)
- 베이커스 퍼센티지
- 수화율 (Hydration)

#### 2.6.4 타이머 템플릿 설명
- 사워도우 기본 템플릿
- 일반 도우 기본 템플릿
- 단계별 시간 설명

---

### 2.7 설정

#### 2.7.1 사용자 정보
- **표시**: 로그인한 사용자 이메일 (TODO)

#### 2.7.2 앱 정보
- 버전 정보 표시

#### 2.7.3 로그아웃
- **기능**: 로그아웃 (TODO)
- **동작**: 로그인 화면으로 이동

---

## 3. 데이터 흐름

### 3.1 레시피 생성 플로우
```
1. 계산기에서 값 입력
2. 실시간 계산 결과 표시
3. "레시피로 저장" 클릭
4. 레시피 이름 입력 (다이얼로그)
5. Database에 저장 (RecipesCompanion)
6. 스낵바로 저장 완료 알림
```

### 3.2 타이머 시작 플로우
```
1. 내 레시피에서 레시피 선택
2. "이 레시피로 타이머 시작" 클릭
3. TimerSetupScreen 진입
4. 레시피에 저장된 timerSteps 로드 (없으면 템플릿)
5. 사용자가 단계 편집
6. "타이머 시작" 클릭
7. 편집된 단계를 레시피에 저장 (updateRecipe)
8. Background Service에 타이머 시작 요청
9. 메인 화면 복귀 + 타이머 탭으로 전환
10. 백그라운드에서 타이머 실행
```

### 3.3 타이머 업데이트 플로우
```
1. Background Service가 매초 타이머 업데이트
2. 'update' 이벤트로 UI에 데이터 전송
   - activeTimers 리스트
   - 각 타이머의 현재 상태
3. TimerScreen이 Stream 리스닝
4. setState로 UI 갱신
5. 단계 완료 시 알림 발송
```

---

## 4. 사용자 시나리오

### 4.1 사워도우 빵 만들기
```
1. 로그인
2. 계산기 탭 → 베이커스 계산기
3. 총 르방 500g, 온도 25°C, 준비 시간 8시간 입력
4. 자동 계산된 비율 확인 (1:2:2)
5. 필요시 비율 조정
6. "레시피로 저장" → "내 사워도우 v1"
7. 내 레시피 탭에서 저장된 레시피 확인
8. "이 레시피로 타이머 시작"
9. 사워도우 템플릿 확인 (16시간 과정)
10. 2차 발효 시간을 14시간으로 조정
11. "타이머 시작"
12. 자동으로 타이머 탭으로 전환
13. 각 단계마다 알림 받으며 진행
14. 완료 후 타이머 삭제
```

### 4.2 피자 도우 만들기
```
1. 로그인
2. 계산기 탭 → 도우 계산기
3. 총 도우 무게 800g 입력
4. 물 65%, 소금 2%, 르방 0% (상업 이스트 사용)
5. 밀가루 상세:
   - 강력분 560g (70%)
   - 통밀 240g (30%)
6. 추가 재료:
   - 올리브유 3%
7. 계산 결과 확인
8. "레시피로 저장" → "피자 도우"
9. "이 레시피로 타이머 시작"
10. 일반 도우 템플릿 확인 (4시간)
11. 필요에 따라 시간 조정
12. 타이머 시작하여 제작
```

### 4.3 도우 계산 중 조정
```
1. 도우 계산기에서 총 도우 500g 입력
2. 물 70% 입력 → 182g 표시
3. "물이 너무 많네, 150g만 쓰자"
4. 물 g 필드에 150 입력
5. 자동으로 물 % 재계산: 59.5%
6. 소금, 르방도 자동으로 재계산됨
7. 밀가루는 252g으로 변경됨 (총 500g 유지)
8. 저장하여 레시피 보관
```

---

## 5. 예외 처리

### 5.1 입력 검증
- 숫자 필드: 숫자만 입력 가능 (FilteringTextInputFormatter)
- 음수: 허용 안 함
- 빈 값: 0으로 처리

### 5.2 밀가루 합계 검증
- 합계 ≠ 총 밀가루: 경고 표시
  - "⚠️ 50g 초과"
  - "⚠️ 30g 부족"
- 테두리 색상 변경 (빨간색)

### 5.3 데이터베이스 오류
- 저장 실패: 스낵바로 오류 메시지
- 마이그레이션 실패: 앱 재설치 필요

### 5.4 백그라운드 서비스
- 권한 없음: Android 알림 권한 요청
- 서비스 중단: 앱 재시작 시 복구 시도

---

## 6. 향후 개선 사항

### 6.1 인증 시스템
- [ ] 실제 로그인 검증
- [ ] 비밀번호 해싱
- [ ] 소셜 로그인 (Google, Apple)

### 6.2 레시피 관리
- [ ] 레시피 수정 기능
- [ ] 레시피 복제 기능
- [ ] 레시피 공유 (JSON 내보내기/가져오기)
- [ ] 레시피 검색/필터링

### 6.3 타이머 고급 기능
- [ ] 타이머 일시정지/재개
- [ ] 단계 건너뛰기
- [ ] 타이머 알림음 커스터마이징
- [ ] 타이머 히스토리 (완료 기록)

### 6.4 계산기 기능
- [ ] 계산 히스토리
- [ ] 즐겨찾기 레시피
- [ ] 재료 단위 변환 (컵, 스푼 등)

### 6.5 클라우드 동기화
- [ ] 계정별 레시피 클라우드 저장
- [ ] 멀티 디바이스 동기화

---

## 7. 기능 우선순위

### P0 (필수)
- ✅ 베이커스 계산기
- ✅ 도우 계산기
- ✅ 레시피 저장/조회/삭제
- ✅ 타이머 시스템
- ✅ 백그라운드 타이머

### P1 (중요)
- ⬜ 실제 인증 시스템
- ✅ 양방향 입력 (% ↔ g)
- ✅ 타이머 템플릿 자동화
- ✅ 밀가루 상세 입력
- ✅ 추가 재료 입력

### P2 (개선)
- ⬜ 타이머 일시정지/재개
- ⬜ 레시피 수정
- ⬜ 레시피 검색
- ⬜ 다국어 지원

### P3 (추가)
- ⬜ 클라우드 동기화
- ⬜ 레시피 공유
- ⬜ 소셜 기능
